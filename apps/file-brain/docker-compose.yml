services:
  # Apache Tika Server (Docker-based content extraction)
  tika:
    image: apache/tika:latest-full
    container_name: file-brain-data-extractor
    network_mode: "host"
    environment:
      # Tika runs on port 9998 by default
      TIKA_PORT: 9998
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Typesense Search Engine (with GPU support)
  typesense:
    image: typesense/typesense:29.0
    container_name: file-brain-search-engine
    network_mode: "host"
    environment:
      TYPESENSE_API_KEY: ${TYPESENSE_API_KEY:-xyz-typesense-key}
      TYPESENSE_DATA_DIR: /data
    volumes:
      - search-engine-data:/data
    command: >
      --data-dir /data --api-key=${TYPESENSE_API_KEY:-xyz-typesense-key}
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [ gpu ]
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

# Named volumes for data persistence
volumes:
  search-engine-data:
    driver: local
