services:
  # Apache Tika Server (Docker-based content extraction)
  tika:
    image: apache/tika:latest-full
    container_name: file-brain-data-extractor
    network_mode: "host"
    environment:
      # Tika runs on port 9998 by default
      TIKA_PORT: 9998
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Typesense Search Engine (with GPU support)
  typesense:
    image: hamza5/typesense-gpu:29.0-cuda11.8.0-cudnn8-runtime-ubuntu22.04
    container_name: file-brain-search-engine
    network_mode: "host"
    environment:
      TYPESENSE_API_KEY: ${TYPESENSE_API_KEY:-xyz-typesense-key}
      TYPESENSE_DATA_DIR: /data
      TYPESENSE_HEALTHY_READ_LAG: 5000
      TYPESENSE_HEALTHY_WRITE_LAG: 5000
    volumes:
      - search-engine-data:/data
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [ gpu ]
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

# Named volumes for data persistence
volumes:
  search-engine-data:
    driver: local
